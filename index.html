<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voice Assistant Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }

    .form-container {
      max-width: 500px;
      margin: 60px auto;
      background-color: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .form-container h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    .form-container input, .form-container textarea, .form-container button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
    }

    #voiceButton {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background-color: #4a90e2;
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 30px;
      cursor: pointer;
    }

    #audioPlayer {
      display: none;
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>Contact Form</h2>
    <form id="contactForm">
      <label>Name*</label>
      <input type="text" id="name" required>

      <label>Email ID*</label>
      <input type="email" id="email" required>

      <label>Phone Number</label>
      <input type="text" id="phone" placeholder="10-digit number">

      <label>Address</label>
      <textarea id="address"></textarea>

      <button type="submit">Submit</button>
    </form>
  </div>

  <button id="voiceButton">ðŸ”Š</button>
  <audio id="audioPlayer" controls></audio>

  <script>
    const apiUrl = "https://n4kgojcoui.execute-api.eu-west-1.amazonaws.com/polly"; // replace with your actual Polly API Gateway URL
    const audioPlayer = document.getElementById("audioPlayer");
    const form = document.getElementById("contactForm");

    const questions = [
      { key: "name", prompt: "Can I get your first name?" },
      { key: "email", prompt: "Can I get your email ID?" },
      { key: "phone", prompt: "May I have your 10-digit phone number?" },
      { key: "address", prompt: "Please tell me your address." }
    ];

    document.getElementById("voiceButton").addEventListener("click", async () => {
      await speak("Hello I am your AI assistant. I will be helping you to fill this form.");

      for (const field of questions) {
        await speak(field.prompt);
        const answer = prompt(field.prompt);
        if (answer !== null) {
          document.getElementById(field.key).value = answer;
        }
      }

      await speak("Thank you! The form is now filled. Please review and submit.");
    });

    async function speak(text) {
      try {
        const response = await fetch(apiUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ text })
        });

        const data = await response.json();
        if (data.audio) {
          const audioBlob = b64ToBlob(data.audio, "audio/mp3");
          const audioUrl = URL.createObjectURL(audioBlob);
          audioPlayer.src = audioUrl;
          await playAudio(audioPlayer);
        }
      } catch (error) {
        console.error("Error with Polly API:", error);
      }
    }

    function playAudio(audioElement) {
      return new Promise((resolve) => {
        audioElement.onended = resolve;
        audioElement.play();
      });
    }

    function b64ToBlob(base64, mime) {
      const byteChars = atob(base64);
      const byteArrays = [];
      for (let offset = 0; offset < byteChars.length; offset += 512) {
        const slice = byteChars.slice(offset, offset + 512);
        const byteNumbers = new Array(slice.length);
        for (let i = 0; i < slice.length; i++) {
          byteNumbers[i] = slice.charCodeAt(i);
        }
        byteArrays.push(new Uint8Array(byteNumbers));
      }
      return new Blob(byteArrays, { type: mime });
    }
  </script>
</body>
</html>
