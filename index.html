<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voice Assistant Form</title>
</head>
<body>
  <h1>Voice Assistant Form</h1>

  <button id="askButton">Ask Question</button>
  <p id="responseText"></p>
  <audio id="audioPlayer" controls></audio>

  <script>
    const apiUrl = "https://n4kgojcoui.execute-api.eu-west-1.amazonaws.com/polly"; // replace with your API Gateway URL

    document.getElementById("askButton").addEventListener("click", async () => {
      const userText = prompt("What would you like to ask?");
      if (!userText) return;

      const responseTextEl = document.getElementById("responseText");
      const audioPlayer = document.getElementById("audioPlayer");

      try {
        const response = await fetch(apiUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ text: userText })
        });

        const data = await response.json();

        if (data.audio) {
          // Display the text response
          responseTextEl.textContent = "Polly says: " + data.text;

          // Convert base64 to audio
          const audioBlob = b64ToBlob(data.audio, "audio/mp3");
          const audioUrl = URL.createObjectURL(audioBlob);
          audioPlayer.src = audioUrl;
          audioPlayer.play();
        } else {
          responseTextEl.textContent = "No audio returned.";
        }
      } catch (error) {
        console.error("Error:", error);
        responseTextEl.textContent = "Error occurred while calling the API.";
      }
    });

    function b64ToBlob(base64, mime) {
      const byteChars = atob(base64);
      const byteArrays = [];
      for (let offset = 0; offset < byteChars.length; offset += 512) {
        const slice = byteChars.slice(offset, offset + 512);
        const byteNumbers = new Array(slice.length);
        for (let i = 0; i < slice.length; i++) {
          byteNumbers[i] = slice.charCodeAt(i);
        }
        byteArrays.push(new Uint8Array(byteNumbers));
      }
      return new Blob(byteArrays, { type: mime });
    }
  </script>
</body>
</html>
